#!/bin/bash
# Robust wrapper script to run holdem CLI with proper environment

set -e  # Exit on any error

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Function to print colored output
print_info() {
    echo -e "\033[1;34mℹ️  $1\033[0m"
}

print_success() {
    echo -e "\033[1;32m✅ $1\033[0m"
}

print_error() {
    echo -e "\033[1;31m❌ $1\033[0m"
}

print_warning() {
    echo -e "\033[1;33m⚠️  $1\033[0m"
}

# Check if virtual environment exists
if [ ! -d "${SCRIPT_DIR}/venv" ]; then
    print_error "Virtual environment not found at ${SCRIPT_DIR}/venv"
    print_info "Please run setup_dev.py to create the virtual environment:"
    print_info "  python3 setup_dev.py"
    exit 1
fi

# Check if Python executable exists
PYTHON_EXEC="${SCRIPT_DIR}/venv/bin/python3"
if [ ! -x "$PYTHON_EXEC" ]; then
    print_error "Python executable not found at $PYTHON_EXEC"
    print_info "Please recreate the virtual environment:"
    print_info "  python3 setup_dev.py"
    exit 1
fi

# Check if required modules can be imported
print_info "Checking dependencies..."
if ! "$PYTHON_EXEC" -c "import textual; import click; import numpy" 2>/dev/null; then
    print_warning "Some dependencies might be missing"
    print_info "Please install dependencies:"
    print_info "  $PYTHON_EXEC -m pip install -e ."
    print_info "Or recreate the environment:"
    print_info "  python3 setup_dev.py"
fi

# Set the PYTHONPATH and run the holdem CLI
export PYTHONPATH="${SCRIPT_DIR}/src"

print_info "Starting Holdem CLI..."
exec "$PYTHON_EXEC" -m holdem_cli.main "$@"
